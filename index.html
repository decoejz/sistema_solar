<!DOCTYPE html>
<html>
	<head>
        <meta charset="UTF-8">
		<title>Solar System</title>
		<style>
            body {
                margin: 0;
            }
			canvas {
                    display: block;
                    background: url(img/2k_stars_milky_way.jpg) no-repeat center center;
                    background-size: cover;
                    }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script>
            
            //inicio da cena e da câmera
			const scene = new THREE.Scene();
			const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

            var loader = new THREE.TextureLoader();
            const listener = new THREE.AudioListener();
            camera.add( listener );
            
            // create a global audio source
            const sound = new THREE.Audio( listener );

            // load a sound and set it as the Audio object's buffer
            const audioLoader = new THREE.AudioLoader();
            audioLoader.load( 'music/ET_Theme_Song.mp3', function( buffer ) {
                sound.setBuffer( buffer );
                sound.setLoop( true );
                sound.setVolume( 0.5 );
                sound.play();
            });

            const planet = function (size, color, pathTexture = null) {
                const earthgeometry = new THREE.SphereGeometry( size, 100, 100 );
                const earthmaterial = new THREE.MeshPhongMaterial({
                    // color: color,
                // color: 0xFF1F00,
                    map: loader.load(pathTexture),
                    flatShading: true,
                    });
                const earth = new THREE.Mesh( earthgeometry, earthmaterial );
                return earth;
            };

            const orbit = function (ratio) {
                const geo = new THREE.CircleGeometry( ratio, 100);
                const mat = new THREE.LineBasicMaterial({color: 0xFFFFFF });
                const line = new THREE.Mesh( geo, mat );
                line.rotation.z = 90.0*Math.PI/180.0;
                return line;
            }

			const renderer = new THREE.WebGLRenderer({
                alpha: true,
            });
            renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

            // posição da câmera
            camera.position.z = 200;
            camera.position.y = 100;
            camera.rotation.x = -0.2;

            
            //ambiance light
            const lightamb = new THREE.AmbientLight( 0x373030 ); // soft white light
            scene.add( lightamb );

            //sol
            const sunRatio = 30.0;
			const sungeometry = new THREE.SphereGeometry( sunRatio, 100, 100 );
            const sunmaterial = new THREE.MeshBasicMaterial({
                map: loader.load('img/2k_sun.jpg'),
                flatShading: true,
                });
            const sun = new THREE.Mesh( sungeometry, sunmaterial );
            sun.position.z = -300;
            scene.add( sun );
            // sun light
            const pointLight = new THREE.PointLight( 0xffffff, 1.0 );
            pointLight.position.z = -300;
            scene.add( pointLight );

            //mercury
            const mercuryRatio = 5.0;
            const mercury = planet(mercuryRatio, 0x5d615e, 'img/2k_mercury.jpg')
            sun.add( mercury );

            //venus
            const venusRatio = 10.0;
            const venus = planet(venusRatio, 0x5d615e, 'img/2k_venus.jpg')
            sun.add( venus );

            //earth
            const earthRatio = 11.0;
            const earth = planet(earthRatio, 0x0000FF, 'img/2k_earth.jpg')
            sun.add( earth );
            //moon
            const moonRatio = 2.0;
            const moon = planet(moonRatio, 0x0000FF, 'img/2k_moon.jpg')
            earth.add( moon );

            //mars
            const marsRatio = 6.0;
            const mars = planet(marsRatio, 0x0000FF, 'img/2k_mars.jpg')
            sun.add( mars );
            //phobos
            const phobosRatio = 2.0;
            const phobos = planet(phobosRatio, 0x0000FF, 'img/2k_moon.jpg')
            mars.add( phobos );
            phobos.position.y = 3.0;
            //deimos
            const deimosRatio = 1.5;
            const deimos = planet(deimosRatio, 0x0000FF, 'img/2k_moon.jpg')
            mars.add( deimos );
            deimos.position.y = -4.0;

            //jupter
            const jupterRatio = 22.0;
            const jupter = planet(jupterRatio, 0xFF7F00, 'img/2k_jupiter.jpg')
            sun.add( jupter );
            // moons
            moonsJ = [];
            moonsJraios = [];
            moonsJangle = [];
            ratios = 1.0;
            raios = 23.0;
            angles = 0.12;
            for(var i = 0; i < 20; i++) {
                angles += 0.1;
                raios += 1.0;
                ratios += 0.3;
                moonsJ.push(planet(ratios, 0x0000FF, 'img/2k_moon.jpg'))
                moonsJraios.push(raios);
                moonsJangle.push(angles);
                jupter.add( moonsJ[i] );
                moonsJ[i].position.y = -ratios*10/3;
            }

            //saturn
            const saturnRatio = 14.0;
            const saturn = planet(saturnRatio, 0xFF7F00, 'img/2k_saturn.jpg')
            sun.add( saturn );
            const ringgeometry = new THREE.RingGeometry( 25.0, 16.0, 50.0 );
            const ringmaterial = new THREE.MeshBasicMaterial( { map: loader.load('img/2k_saturn_ring.png') } );
            // ringmaterial.rotation = (90.0*Math.PI/180.0);
            ringmaterial.repeat = 20;
            const ring = new THREE.Mesh( ringgeometry, ringmaterial );
            ring.rotation.y = -90.0*Math.PI/180.0;
            saturn.rotation.z = 90.0*Math.PI/180.0;
            saturn.add( ring );
            ring.position.x = -1.0;

            //uranus
            const uranusRatio = 16.0;
            const uranus = planet(uranusRatio, 0xFF7F00, 'img/2k_uranus.jpg')
            sun.add( uranus );

            //neptune
            const neptuneRatio = 16.0;
            const neptune = planet(neptuneRatio, 0xFF7F00, 'img/2k_neptune.jpg')
            sun.add( neptune );

            // orbit line planets
            const merLine = orbit(mercuryRatio);
            sun.add( merLine );
            const venLine = orbit(venusRatio);
            sun.add( venLine );
            const earLine = orbit(earthRatio);
            sun.add( earLine );
            const marLine = orbit(marsRatio);
            sun.add( marLine );
            const jupLine = orbit(jupterRatio);
            sun.add( jupLine );
            const urLine = orbit(uranusRatio);
            sun.add( urLine );
            const neptLine = orbit(neptuneRatio);
            sun.add( neptLine );
            
            // velocidades angulares dos planetas
            angleM = 0;
            angleV = 0;
            angleE = 0;
            angleMars = 0;
            angleJ = 0;
            angleS = 0;
            angleU = 0;
            angleN = 0;

            angleMoon = 0;
            angledeimos = 0;
            anglephobos = 0;

            raioM = 60;
            raioV = 100;
            raioE = 130;
            raioMars = 180;
            raioJ = 230;
            raioS = 290;
            raioU = 350;
            raioN = 400;

            raioMoon = 13.0;
            raiodeimos = 9.0;
            raiophobos= 8.0;

            //animação dos planetas (translação e rotação)
			const animate = function () {
				requestAnimationFrame( animate );
                angleM += 0.05;
                angleV += 0.045;
                angleE += 0.0372;
                angleMars += 0.03;
                angleJ += 0.025;
                angleS += 0.0183;
                angleU += 0.0155;
                angleN += 0.013;
                angleMoon += 0.1;
                angledeimos += 0.15;
                anglephobos += 0.1;

                sun.rotation.y += 0.01;

                //mercury
                mercury.rotation.y += 0.01;
                mercury.position.z = raioM*Math.sin(angleM);
                mercury.position.x = raioM*Math.cos(angleM);

                //venus
                venus.rotation.y += 0.01;
                venus.position.z = raioV*Math.sin(angleV);
                venus.position.x = raioV*Math.cos(angleV);

                //earth
                earth.rotation.y += 0.01;
                earth.position.z = raioE*Math.sin(angleE);
                earth.position.x = raioE*Math.cos(angleE);
                //moon
                moon.rotation.y += 0.01;
                moon.position.z = raioMoon*Math.sin(angleMoon);
                moon.position.x = raioMoon*Math.cos(angleMoon);

                //mars
                mars.rotation.y += 0.01;
                mars.position.z = raioMars*Math.sin(angleMars);
                mars.position.x = raioMars*Math.cos(angleMars);
                //phobos
                phobos.rotation.y += 0.01;
                phobos.position.z = raiophobos*Math.sin(anglephobos);
                phobos.position.x = raiophobos*Math.cos(anglephobos);
                //deimos
                deimos.rotation.y += 0.01;
                deimos.position.z = raiodeimos*Math.sin(angledeimos);
                deimos.position.x = raiodeimos*Math.cos(angledeimos);
                
                // jupter
                jupter.rotation.y += 0.01;
                jupter.position.z = raioJ*Math.sin(angleJ);
                jupter.position.x = raioJ*Math.cos(angleJ);
                for(var i = 0; i < 20; i++) {
                    moonsJangle[i] += 0.2;
                    moonsJ[i].rotation.y += 0.01;
                    moonsJ[i].position.z = moonRatio[i]*Math.sin(moonsJangle[i]);
                    moonsJ[i].position.x = moonRatio[i]*Math.cos(moonsJangle[i]);
                }

                // saturn
                saturn.rotation.y += 0.01;
                saturn.position.z = raioS*Math.sin(angleS);
                saturn.position.x = raioS*Math.cos(angleS);

                // uranus
                uranus.rotation.y += 0.01;
                uranus.position.z = raioU*Math.sin(angleU);
                uranus.position.x = raioU*Math.cos(angleU);

                // neptune
                neptune.rotation.y += 0.01;
                neptune.position.z = raioN*Math.sin(angleN);
                neptune.position.x = raioN*Math.cos(angleN);
                

				renderer.render( scene, camera );
			};

			animate();
		</script>
	</body>
</html>